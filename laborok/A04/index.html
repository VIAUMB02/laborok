
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Forstner Bertalan, Pomázi Kriszitán, Sik Dávid, Hideg Attila">
      
      
      
        <link rel="prev" href="../A03/">
      
      
        <link rel="next" href="../A05/">
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.14">
    
    
      
        <title>Labor10 - Időzítés és értesítések (Alarm) - BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#labor10-idozites-es-ertesitesek-alarm" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok" class="md-header__button md-logo" aria-label="BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Labor10 - Időzítés és értesítések (Alarm)
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="red" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent=""  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/VIAUMB02/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaumb02/laborok
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Tudnivalók
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../A01/" class="md-tabs__link md-tabs__link--active">
        Android Laborok
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok" class="md-nav__button md-logo" aria-label="BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok" data-md-component="logo">
      
  <img src="../../logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUMB02 - Mobilszoftver laboratórium laborfeladatok
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/VIAUMB02/laborok" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    viaumb02/laborok
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Tudnivalók
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Tudnivalók
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Tárgy ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub/" class="md-nav__link">
        Feladatok beadása (GitHub)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-Actions/" class="md-nav__link">
        GitHub Actions ismertető
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/GitHub-credentials/" class="md-nav__link">
        Egyetemi laborokban: GitHub belépés
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tudnivalok/github/contributing/" class="md-nav__link">
        Hozzájárulás az anyaghoz
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Android Laborok
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Android Laborok
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../A01/" class="md-nav__link">
        Android 1 - Specifikáció
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../A02/" class="md-nav__link">
        Android 1 - Architektúra és környezet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../A03/" class="md-nav__link">
        Labor10 - Időzítés és értesítések (Alarm)
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Labor10 - Időzítés és értesítések (Alarm)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Labor10 - Időzítés és értesítések (Alarm)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezetes" class="md-nav__link">
    Bevezetés
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-projekt-megnyitasa" class="md-nav__link">
    A projekt megnyitása
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-fuggosegek-beallitasa" class="md-nav__link">
    A függőségek beállítása
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-domenmodellek-elkeszitese" class="md-nav__link">
    A doménmodellek elkészítése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-felhasznaloi-felulet-es-a-domenmodell-osszekotese" class="md-nav__link">
    A felhasználói felület és a doménmodell összekötése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-idozites-elkeszitese" class="md-nav__link">
    Az időzítés elkészítése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-ertesitesek-kuldese" class="md-nav__link">
    Az értesítések küldése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-service-elkeszitese" class="md-nav__link">
    A Service elkészítése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat" class="md-nav__link">
    Önálló feladat
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../A05/" class="md-nav__link">
        Labor10 - Időzítés és értesítések (Alarm)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#bevezetes" class="md-nav__link">
    Bevezetés
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elokeszuletek" class="md-nav__link">
    Előkészületek
  </a>
  
    <nav class="md-nav" aria-label="Előkészületek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#git-repository-letrehozasa-es-letoltese" class="md-nav__link">
    Git repository létrehozása és letöltése
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-projekt-megnyitasa" class="md-nav__link">
    A projekt megnyitása
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-fuggosegek-beallitasa" class="md-nav__link">
    A függőségek beállítása
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-domenmodellek-elkeszitese" class="md-nav__link">
    A doménmodellek elkészítése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-felhasznaloi-felulet-es-a-domenmodell-osszekotese" class="md-nav__link">
    A felhasználói felület és a doménmodell összekötése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-idozites-elkeszitese" class="md-nav__link">
    Az időzítés elkészítése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#az-ertesitesek-kuldese" class="md-nav__link">
    Az értesítések küldése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-service-elkeszitese" class="md-nav__link">
    A Service elkészítése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onallo-feladat" class="md-nav__link">
    Önálló feladat
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="labor10-idozites-es-ertesitesek-alarm">Labor10 - Időzítés és értesítések (Alarm)<a class="headerlink" href="#labor10-idozites-es-ertesitesek-alarm" title="Permanent link">&para;</a></h1>
<h2 id="bevezetes">Bevezetés<a class="headerlink" href="#bevezetes" title="Permanent link">&para;</a></h2>
<p>Ebben a laborban egy időzítő alkalmazást készítünk, amely a beállított időintervallum eltelte után értesítést küld, akkor is, ha az alkalamzás felhasználói felülete nincs az előtérben, mert közben a felhasználó másik alkalmazást indított. </p>
<p>A laborban érintett főbb témakörök:</p>
<ul>
<li>Háttérfeladat futtatása Service segítségével</li>
<li>Időzített feladatok</li>
<li>Értesítések küldése</li>
</ul>
<h2 id="elokeszuletek">Előkészületek<a class="headerlink" href="#elokeszuletek" title="Permanent link">&para;</a></h2>
<p>A feladatok megoldása során ne felejtsd el követni a <a href="../../tudnivalok/github/GitHub/">feladat beadás folyamatát</a>.</p>
<h3 id="git-repository-letrehozasa-es-letoltese">Git repository létrehozása és letöltése<a class="headerlink" href="#git-repository-letrehozasa-es-letoltese" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Moodle-ben keresd meg a laborhoz tartozó meghívó URL-jét és annak segítségével hozd létre a saját repository-dat.</p>
</li>
<li>
<p>Várd meg, míg elkészül a repository, majd checkout-old ki.</p>
<div class="admonition tip">
<p>Egyetemi laborokban, ha a checkout során nem kér a rendszer felhasználónevet és jelszót, és nem sikerül a checkout, akkor valószínűleg a gépen korábban megjegyzett felhasználónévvel próbálkozott a rendszer. Először töröld ki a mentett belépési adatokat (lásd <a href="../../tudnivalok/github/GitHub-credentials/">itt</a>), és próbáld újra.</p>
</div>
</li>
<li>
<p>Hozz létre egy új ágat <code>megoldas</code> néven, és ezen az ágon dolgozz.</p>
</li>
<li>
<p>A <code>neptun.txt</code> fájlba írd bele a Neptun kódodat. A fájlban semmi más ne szerepeljen, csak egyetlen sorban a Neptun kód 6 karaktere.</p>
</li>
</ol>
<h2 id="a-projekt-megnyitasa">A projekt megnyitása<a class="headerlink" href="#a-projekt-megnyitasa" title="Permanent link">&para;</a></h2>
<p>Nyissuk meg a template-ben levő projektet, és a laborvezetővel tekintsük át a tartalmát. A projektben
a UI építőelemei és a <code>drawable</code> erőforrások már megtalálhatók. Ezekhez fogjuk elkészíteni az időzítő
üzleti logikáját, amit összekötünk az előkészített felhasználói felülettel.</p>
<h2 id="a-fuggosegek-beallitasa">A függőségek beállítása<a class="headerlink" href="#a-fuggosegek-beallitasa" title="Permanent link">&para;</a></h2>
<p>Vegyük fel az alábbi függőségeket a modul szintű <code>build.gradle.kts</code> fájlba. Ezekre az idő megadásához
lesz majd szükségünk.</p>
<div class="highlight"><pre><span></span><code><span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.maxkeppeler.sheets-compose-dialogs:core:1.0.3&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.maxkeppeler.sheets-compose-dialogs:clock:1.0.3&quot;</span><span class="p">)</span>
<span class="n">implementation</span><span class="p">(</span><span class="s">&quot;com.maxkeppeler.sheets-compose-dialogs:duration:1.0.3&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="a-domenmodellek-elkeszitese">A doménmodellek elkészítése<a class="headerlink" href="#a-domenmodellek-elkeszitese" title="Permanent link">&para;</a></h2>
<p>Először néhány olyan osztályt készítünk, amelyekkel az alkalmazás aktuális állapota, illetve az állapotváltozást előidéző események reprezentálhatók. Ehhez készítsünk egy <code>util</code> package-et. Ebbe hozzuk létre az alábbi osztályt:</p>
<div class="highlight"><pre><span></span><code><span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AlarmEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SetAlarmDuration</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">duration</span><span class="p">:</span><span class="w"> </span><span class="n">Duration</span><span class="p">):</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SetAlarm</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">PauseAlarm</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ResumeAlarm</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">()</span>
<span class="w">    </span><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">StopAlarm</span><span class="p">(</span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">):</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Az osztály tartalma könnyen megérthető, az egyes felhasználói interakciókat mint lehetséges eseményeket jelképezi.</p>
<p>Most hozzuk létre az alábbi osztályokat egy fájlban:</p>
<div class="highlight"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AlarmServiceState</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">IDLE</span><span class="p">,</span><span class="w"> </span><span class="n">SET</span><span class="p">,</span><span class="w"> </span><span class="n">PAUSE</span><span class="p">,</span><span class="w"> </span><span class="n">CANCELED</span>
<span class="p">}</span>

<span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AlarmState</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">currentAlarmDuration</span><span class="p">:</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">alarmDuration</span><span class="p">:</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">alarmState</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">IDLE</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MutableStateFlow</span><span class="p">(</span><span class="n">AlarmState</span><span class="p">())</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isAlarmSet</span><span class="p">():</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isAlarmPaused</span><span class="p">():</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isAlarmIdle</span><span class="p">():</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">IDLE</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span>

<span class="w">        </span><span class="kd">fun</span><span class="w"> </span><span class="nf">isStopEnabled</span><span class="p">():</span><span class="w"> </span><span class="kt">Boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Az <code>AlarmServiceState</code> lehetséges értékei írják le, hogy az időzítő épp várakozik, fut, pauzált vagy leállított. Az <code>AlarmState</code> ezt az aktuális állapotot tárolja, és mellé még egységbe zárja, hogy mennyi az időzítő célideje, és mennyi telt el eddig.</p>
<h2 id="a-felhasznaloi-felulet-es-a-domenmodell-osszekotese">A felhasználói felület és a doménmodell összekötése<a class="headerlink" href="#a-felhasznaloi-felulet-es-a-domenmodell-osszekotese" title="Permanent link">&para;</a></h2>
<p>A felhasználói felületünk a template-ben már rendelkezésre áll, de a viewmodelleket még el kell készítenünk, hogy
az imént létrehozott doménmodellel a UI-t össze tudjuk kapcsolni. A <code>ui.alarm</code> package-be hozzuk létre a ViewModelünket:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@HiltViewModel</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AlarmViewModel</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">():</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmState</span><span class="p">.</span><span class="na">state</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">when</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">SetAlarmDuration</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">duration</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">duration</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">SetAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// TODO: Service kommunikáció</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">PauseAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// TODO: Service kommunikáció</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">ResumeAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// TODO: Service kommunikáció</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">StopAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="c1">// TODO: Service kommunikáció</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Látható, hogy a ViewModel kezeli az eseményeket, és az alkalmazás állapotát ennek megfelelően frissíti, azonban a háttérben futó, tényleges időzítést végző <code>AlarmService</code> még nincs kész, így annak hívásai ide nincsenek bekötve.</p>
<p>Most ugyanebbe a package-ben hozzuk létre a teljes képernyőt is:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.animation.ExperimentalAnimationApi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.background</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Arrangement</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Box</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Column</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Row</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.Spacer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.fillMaxSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.padding</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.width</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.foundation.layout.wrapContentSize</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.ExperimentalMaterial3Api</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.MaterialTheme</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.material3.Surface</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.Composable</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.collectAsState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.getValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.mutableStateOf</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.remember</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.runtime.setValue</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Alignment</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.Modifier</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.platform.LocalContext</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.unit.dp</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.compose.ui.window.Popup</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.hilt.navigation.compose.hiltViewModel</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.google.accompanist.permissions.ExperimentalPermissionsApi</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.maxkeppeker.sheets.core.models.base.rememberSheetState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.maxkeppeler.sheets.duration.DurationDialog</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.maxkeppeler.sheets.duration.models.DurationConfig</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.maxkeppeler.sheets.duration.models.DurationFormat</span>
<span class="k">import</span><span class="w"> </span><span class="nn">com.maxkeppeler.sheets.duration.models.DurationSelection</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.R</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.ui.common.AlarmStateButton</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.ui.common.DurationCounter</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.ui.theme.pauseColor</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.ui.theme.startColor</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.ui.theme.stopColor</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.util.AlarmEvent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.util.AlarmState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.time.DurationUnit</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.time.toDuration</span>

<span class="nd">@OptIn</span><span class="p">(</span><span class="n">ExperimentalMaterial3Api</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@ExperimentalPermissionsApi</span>
<span class="nd">@ExperimentalAnimationApi</span>
<span class="nd">@Composable</span>
<span class="kd">fun</span><span class="w"> </span><span class="nf">AlarmScreen</span><span class="p">(</span>
<span class="w">    </span><span class="n">viewModel</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmViewModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hiltViewModel</span><span class="p">()</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">viewModel</span><span class="p">.</span><span class="na">state</span><span class="p">.</span><span class="na">collectAsState</span><span class="p">()</span>

<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalContext</span><span class="p">.</span><span class="na">current</span>

<span class="w">    </span><span class="n">Column</span><span class="p">(</span>
<span class="w">        </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">            </span><span class="p">.</span><span class="na">fillMaxSize</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">background</span><span class="p">(</span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">background</span><span class="p">),</span>
<span class="w">        </span><span class="n">horizontalAlignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">CenterHorizontally</span><span class="p">,</span>
<span class="w">        </span><span class="n">verticalArrangement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrangement</span><span class="p">.</span><span class="na">Center</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nv">isDialogShown</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">remember</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mutableStateOf</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="n">DurationCounter</span><span class="p">(</span>
<span class="w">            </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="p">,</span>
<span class="w">            </span><span class="n">clickEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmIdle</span><span class="p">(),</span>
<span class="w">            </span><span class="n">onClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">isDialogShown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isDialogShown</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">)</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isDialogShown</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Popup</span><span class="p">(</span>
<span class="w">                </span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">,</span>
<span class="w">                </span><span class="n">onDismissRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isDialogShown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isDialogShown</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Box</span><span class="p">(</span>
<span class="w">                    </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">wrapContentSize</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Surface</span><span class="p">(</span>
<span class="w">                        </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">shapes</span><span class="p">.</span><span class="na">medium</span><span class="p">,</span>
<span class="w">                        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">surface</span><span class="p">,</span>
<span class="w">                    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">DurationDialog</span><span class="p">(</span>
<span class="w">                            </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rememberSheetState</span><span class="p">(</span>
<span class="w">                                </span><span class="n">visible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">                                </span><span class="n">onCloseRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">isDialogShown</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">isDialogShown</span><span class="w"> </span><span class="p">}</span>
<span class="w">                            </span><span class="p">),</span>
<span class="w">                            </span><span class="n">selection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationSelection</span><span class="w"> </span><span class="p">{</span>
<span class="w">                                </span><span class="kd">val</span><span class="w"> </span><span class="nv">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">toDuration</span><span class="p">(</span><span class="n">DurationUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">)</span>
<span class="w">                                </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">SetAlarmDuration</span><span class="p">(</span><span class="n">duration</span><span class="p">))</span>
<span class="w">                            </span><span class="p">},</span>
<span class="w">                            </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationConfig</span><span class="p">(</span>
<span class="w">                                </span><span class="n">timeFormat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DurationFormat</span><span class="p">.</span><span class="na">HH_MM_SS</span><span class="p">,</span>
<span class="w">                                </span><span class="n">currentTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0L</span><span class="p">,</span>
<span class="w">                            </span><span class="p">),</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Row</span><span class="p">(</span>
<span class="w">            </span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span>
<span class="w">                </span><span class="p">.</span><span class="na">padding</span><span class="p">(</span><span class="n">vertical</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10.</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">wrapContentSize</span><span class="p">(</span><span class="n">Alignment</span><span class="p">.</span><span class="na">Center</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">AlarmStateButton</span><span class="p">(</span>
<span class="w">                </span><span class="n">iconId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmSet</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmPaused</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">pause_24</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">play_24</span><span class="p">,</span>
<span class="w">                </span><span class="n">surfaceColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmSet</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmPaused</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">pauseColor</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">startColor</span><span class="p">,</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmSet</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">SetAlarm</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isAlarmPaused</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">ResumeAlarm</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">PauseAlarm</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Spacer</span><span class="p">(</span><span class="n">modifier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Modifier</span><span class="p">.</span><span class="na">width</span><span class="p">(</span><span class="m">5.</span><span class="n">dp</span><span class="p">))</span>
<span class="w">            </span><span class="n">AlarmStateButton</span><span class="p">(</span>
<span class="w">                </span><span class="n">iconId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">stop_24</span><span class="p">,</span>
<span class="w">                </span><span class="n">surfaceColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaterialTheme</span><span class="p">.</span><span class="na">colorScheme</span><span class="p">.</span><span class="na">stopColor</span><span class="p">,</span>
<span class="w">                </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmState</span><span class="p">.</span><span class="na">isStopEnabled</span><span class="p">()</span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">viewModel</span><span class="p">.</span><span class="na">onEvent</span><span class="p">(</span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">StopAlarm</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Még létre kell hoznunk az <code>AlarmApplication</code> osztályt pusztán a Hilt inicializálásához:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@HiltAndroidApp</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AlarmApplication</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Application</span><span class="p">()</span>
</code></pre></div>
<p>És az osztályt regisztráljuk is be a Manifest fájlban:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">&lt;application</span>
<span class="w">        </span><span class="na">android:name=</span><span class="s">&quot;.AlarmApplication&quot;</span>

<span class="w">        </span><span class="err">...</span>
</code></pre></div>
<p>Bár még az alkalmazáslogikánk nem működik ténylegesen, vegyük fel ide a szükséges engedélyeket is. Az alkalmazásunk egy előtérben futó (foreground) Service-t fog használni ahhoz, hogy az időzítés akkor is működjön, ha az alkalmazás <code>Activity</code>-je már nem látható. Az ilyen Service-ekhez kötelező, hogy legyen értesítés az értesítési sávon, hogy a felhasználó mindig lássa, hogy milyen alkalmazások futnak a háttérben. (Ennek egy tipikus példája a zenelejátszó alkalmazások esete is.() Ezért az értesítésekhez szükséges engedélyt is fel kell venni. Szükséges még a pontos riasztás, és a pontos riasztás időzítésének engedélye:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.FOREGROUND_SERVICE&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.POST_NOTIFICATIONS&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.SCHEDULE_EXACT_ALARM&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;uses-permission</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;android.permission.USE_EXACT_ALARM&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>Még a <code>MainActivity</code> elkészítése maradt hátra az alapvető feladatok közül. Ebben elkérjük az engedélyeket, és megjelenítjük a létrehozott képernyőt:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ExperimentalPermissionsApi</span>
<span class="nd">@ExperimentalAnimationApi</span>
<span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">MainActivity</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ComponentActivity</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span><span class="w"> </span><span class="n">Bundle?)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>

<span class="w">        </span><span class="n">setContent</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">AlarmTheme</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">AlarmScreen</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">TIRAMISU</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">requestPermissions</span><span class="p">(</span>
<span class="w">                </span><span class="n">Manifest</span><span class="p">.</span><span class="na">permission</span><span class="p">.</span><span class="na">POST_NOTIFICATIONS</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">requestPermissions</span><span class="p">(</span><span class="k">vararg</span><span class="w"> </span><span class="n">permissions</span><span class="p">:</span><span class="w"> </span><span class="kt">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">requestPermissionLauncher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">registerForActivityResult</span><span class="p">(</span>
<span class="w">            </span><span class="n">ActivityResultContracts</span><span class="p">.</span><span class="na">RequestMultiplePermissions</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="na">entries</span><span class="p">.</span><span class="na">forEach</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Log</span><span class="p">.</span><span class="na">d</span><span class="p">(</span><span class="s">&quot;MainActivity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="si">${</span><span class="nb">it</span><span class="p">.</span><span class="na">key</span><span class="si">}</span><span class="s"> = </span><span class="si">${</span><span class="nb">it</span><span class="p">.</span><span class="na">value</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">requestPermissionLauncher</span><span class="p">.</span><span class="na">launch</span><span class="p">(</span><span class="n">permissions</span><span class="p">.</span><span class="na">asList</span><span class="p">().</span><span class="na">toTypedArray</span><span class="p">())</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Ha a <code>POST_NOTIFICATIONS</code> konstansot nem találja a fordító, akkor az <code>import android.Manifest</code> sort vegyük fel a fájl elejére.</p>
<p>Most már indítható az alkalmazás, és megjelenik a felhasználói felület, de még nem működik érdemi módon, hiszen a az üzleti logikát végző <code>Service</code> nincs kész.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik a <strong>futó alkalmazás</strong>, az <strong>általad írt kódrészlet</strong>, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>. </p>
<p>A képet a megoldásban a repository-ba f1.png néven töltsd föl.</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="az-idozites-elkeszitese">Az időzítés elkészítése<a class="headerlink" href="#az-idozites-elkeszitese" title="Permanent link">&para;</a></h2>
<p>A <code>Service</code> komponensünk a fentiek alapján időzítést és értesítéseket is fog használni, ezért először ezekhez készítünk némi segédlogikát, hogy a <code>Service</code> utána könnyebben elkészíthető legyen. </p>
<p>Az időzítést kiszervezzük egy segédosztályba, hogy a <code>Service</code> kódja átláthatóbb maradjon. Először egy <code>AlarmItem</code> osztályt készítünk, ez egy időzítendő eseményt jelöl, tulajdonképpen csak az időzítés idejét tartalmazza. Ezt egy új, <code>scheduler</code> nevű package-be tegyük:</p>
<div class="highlight"><pre><span></span><code><span class="kd">data</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">AlarmItem</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">time</span><span class="p">:</span><span class="w"> </span><span class="n">LocalDateTime</span>
<span class="p">)</span>
</code></pre></div>
<p>Szintén ebbe a package-be készítünk egy <code>AlarmReceiver</code> nevű <code>BroadcastReceivert</code>, ezt fogjuk beregisztrálni majd az időzítés leteltére, és az Android időzítő rendszere az idő leteltekor ennek fog értesítést küldeni. Ebben egy <code>Intent</code> segítségével a <code>Service</code> komponenst fogjuk meghívni, de mivel ez még nincs kész, így a kód jelenleg nem fordul le, majd a <code>Service</code> elkészültekor válik az egész működőképessé. Ezt az osztályt is a <code>scheduler</code> package-be tegyük:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">AlarmReceiver</span><span class="p">:</span><span class="w"> </span><span class="n">BroadcastReceiver</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onReceive</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context?,</span><span class="w"> </span><span class="n">intent</span><span class="p">:</span><span class="w"> </span><span class="n">Intent?)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmService</span><span class="p">.</span><span class="na">ACTION_PLAY</span>
<span class="w">            </span><span class="n">context</span><span class="o">?.</span><span class="na">startService</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Mivel a <code>BroadcastReceiver</code> is egy fő komponenstípus Androidon, ezért ezt a Manifest fájlban is szükséges regisztrálni:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;receiver</span><span class="w"> </span><span class="na">android:name=</span><span class="s">&quot;.scheduler.AlarmReceiver&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>És végül egy <code>AlarmScheduler</code> osztályt készítünk:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">AlarmScheduler</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="nd">@ApplicationContext</span><span class="w"> </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">alarmManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getSystemService</span><span class="p">(</span><span class="n">AlarmManager</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">schedule</span><span class="p">(</span><span class="n">alarmItem</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmReceiver</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putExtra</span><span class="p">(</span><span class="s">&quot;ALARM_TIME&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">alarmItem</span><span class="p">.</span><span class="na">time</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">alarmManager</span><span class="p">.</span><span class="na">setExactAndAllowWhileIdle</span><span class="p">(</span>
<span class="w">            </span><span class="n">AlarmManager</span><span class="p">.</span><span class="na">RTC_WAKEUP</span><span class="p">,</span>
<span class="w">            </span><span class="n">alarmItem</span><span class="p">.</span><span class="na">time</span><span class="p">.</span><span class="na">atZone</span><span class="p">(</span><span class="n">ZoneId</span><span class="p">.</span><span class="na">systemDefault</span><span class="p">()).</span><span class="na">toEpochSecond</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span>
<span class="w">            </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">getBroadcast</span><span class="p">(</span>
<span class="w">                </span><span class="n">context</span><span class="p">,</span>
<span class="w">                </span><span class="n">alarmItem</span><span class="p">.</span><span class="na">hashCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">intent</span><span class="p">,</span>
<span class="w">                </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">FLAG_UPDATE_CURRENT</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">FLAG_IMMUTABLE</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">cancel</span><span class="p">(</span><span class="n">item</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmItem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">alarmManager</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span>
<span class="w">            </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">getBroadcast</span><span class="p">(</span>
<span class="w">                </span><span class="n">context</span><span class="p">,</span>
<span class="w">                </span><span class="n">item</span><span class="p">.</span><span class="na">hashCode</span><span class="p">(),</span>
<span class="w">                </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmReceiver</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">),</span>
<span class="w">                </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">FLAG_UPDATE_CURRENT</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">FLAG_IMMUTABLE</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>Ebben az osztályban a rendszertől kérünk referenciát az <code>AlarmManagerre</code>, amelynek segítségével a rendszerben levő időzítő szolgáltatások elérhetőek. Az osztály két metódust definiál, az egyikkel eseményt időzíthetünk, a másikkal pedig meglévő időzítést törölhetünk.</p>
<h2 id="az-ertesitesek-kuldese">Az értesítések küldése<a class="headerlink" href="#az-ertesitesek-kuldese" title="Permanent link">&para;</a></h2>
<p>Az értesítések küldését is kiszervezzük, hogy a <code>Service</code> osztályunk egyszerűbb legyen. Először is a <code>notification</code> package-et hozzuk létre, és ebben készítsük el a <code>NotificationHelper</code> osztályt:</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">NotificationHelper</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">(</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">notificationManager</span><span class="p">:</span><span class="w"> </span><span class="n">NotificationManager</span><span class="p">,</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">notificationBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Builder</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">updateNotification</span><span class="p">(</span>
<span class="w">        </span><span class="n">hours</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">        </span><span class="n">minutes</span><span class="p">:</span><span class="kt">Int</span><span class="p">,</span>
<span class="w">        </span><span class="n">seconds</span><span class="p">:</span><span class="kt">Int</span><span class="p">,</span>
<span class="w">        </span><span class="n">durationInSeconds</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">durationInSeconds</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">hours</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">minutes</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">seconds</span>
<span class="w">        </span><span class="n">notificationManager</span><span class="p">.</span><span class="na">notify</span><span class="p">(</span>
<span class="w">            </span><span class="n">NOTIFICATION_ID</span><span class="p">,</span>
<span class="w">            </span><span class="n">notificationBuilder</span>
<span class="w">                </span><span class="p">.</span><span class="na">setProgress</span><span class="p">(</span><span class="n">durationInSeconds</span><span class="p">,</span><span class="n">progress</span><span class="p">,</span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">setContentText</span><span class="p">(</span>
<span class="w">                    </span><span class="kt">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%02d:%02d:%02d&quot;</span><span class="p">,</span><span class="n">hours</span><span class="p">,</span><span class="n">minutes</span><span class="p">,</span><span class="n">seconds</span><span class="p">)</span>
<span class="w">                </span><span class="p">).</span><span class="na">build</span><span class="p">()</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">cancelNotification</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">notificationManager</span><span class="p">.</span><span class="na">cancel</span><span class="p">(</span><span class="n">NOTIFICATION_ID</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@SuppressLint</span><span class="p">(</span><span class="s">&quot;RestrictedApi&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">setNotificationButton</span><span class="p">(</span><span class="k">vararg</span><span class="w"> </span><span class="n">actions</span><span class="p">:</span><span class="w"> </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">notificationBuilder</span><span class="p">.</span><span class="na">mActions</span><span class="p">.</span><span class="na">clear</span><span class="p">()</span>
<span class="w">        </span><span class="n">actions</span><span class="p">.</span><span class="na">forEachIndexed</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="n">notificationBuilder</span><span class="p">.</span><span class="na">mActions</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">createNotificationChannel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">O</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">val</span><span class="w"> </span><span class="nv">alarmChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NotificationChannel</span><span class="p">(</span>
<span class="w">                </span><span class="n">NOTIFICATION_CHANNEL_ID</span><span class="p">,</span>
<span class="w">                </span><span class="n">NOTIFICATION_CHANNEL_NAME</span><span class="p">,</span>
<span class="w">                </span><span class="n">NotificationManager</span><span class="p">.</span><span class="na">IMPORTANCE_LOW</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">            </span><span class="n">notificationManager</span><span class="p">.</span><span class="na">createNotificationChannel</span><span class="p">(</span><span class="n">alarmChannel</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">NOTIFICATION_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">101</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">NOTIFICATION_CHANNEL_NAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_NOTIFICATION&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">NOTIFICATION_CHANNEL_ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_NOTIFICATION_ID&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik az <strong>általad írt kódrészlet</strong>, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>. </p>
<p>A képet a megoldásban a repository-ba f2.png néven töltsd föl.</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<p>Tekintsük át, hogyan épül fel ez az osztály!</p>
<ul>
<li>Két függősége van: a <code>NotificationManager</code> segítségével kezelhetők az értesítések a rendszeren, viszont az ennek átadott értesítések akár elég összetettek is lehetnek, ezért a builder tervezési minta szerint a <code>NotificationBuilder</code> segítségével kell őket felépítenünk.</li>
<li>Az <code>updateNotification</code> létrehozza vagy frissíti az értesítést, és ezen megjelenik a hátralevő idő óra, perc, másodperc bontásban, valamint egy folyamatjelző sáv, "progress bar" is, amelyet a hátralevő idő alapján számítunk. Látható, hogy egy numerikus azonosítót is megadunk az értesítéshez, ez teszi lehetővé, hogy utána majd törölni tudjuk.</li>
<li>A <code>cancelNotification</code> törli a már létrehozott értesítést.</li>
<li>
<p>A <code>setNotificationButton</code> segítségével gombokat adhatunk az értesítéshez. Hogy milyen és hány gombot szeretnénk hozzáadni, ez az időzítő állapotától függ, ezért hasznos, hogy külön metódussal adhassuk meg. Például szüneteltetést végző gomb hozzáadásának akkor van értelme, ha az időzítő épp fut.</p>
</li>
<li>
<p>A <code>createNotificationChannel</code> értesítési csatornát hoz létre. Az Android O óta az értesítéseket csatornákhoz kell rendelni. Ez azért hasznos, mert a felhasználó az alkalmazáson belül csatornánként tudja tiltani vagy engedélyezni a csatornákat. Pl. a fontos értesítések külön csatornára szervezhetők, és az elhanyagolhatóbb jelentőségűeket a felhasználó könnyedén letilthatja. Jelen alkalmazásban ezt a lehetőséget nem használjuk ki, csupán egy csatornánk lesz, de azt akkor is létre kell hozzuk. A csatorna többszöri létrehozása nem okoz problémát, ezért elég minden értesítés előtt meghívni, hogy biztosan létrejöjjön, nem szükséges tesztelni, hogy létezik-e.</p>
</li>
</ul>
<p>Látható, hogy a <code>NotificationManager</code> és a <code>NotificationBuilder</code> a <code>NotificationHelper</code> függőségei, amelyeket a konstruktoron keresztül kap meg a Dagger/Hilt segítségével. Viszont ehhez még konfiguráció szükséges, hogy ezek a komponensek valóban létrejöjjenek. Hozzuk létre a <code>notification.di</code> package-et, majd ebben az alábbi modult:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@ExperimentalAnimationApi</span>
<span class="nd">@Module</span>
<span class="nd">@InstallIn</span><span class="p">(</span><span class="n">ServiceComponent</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">object</span><span class="w"> </span><span class="nc">NotificationModule</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Provides</span>
<span class="w">    </span><span class="nd">@ServiceScoped</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideNotificationBuilder</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="n">NOTIFICATION_CHANNEL_ID</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setSmallIcon</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">ic_round_alarm_24</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setContentTitle</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">alarm_notification_title</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">setContentText</span><span class="p">(</span><span class="s">&quot;00:00&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setOngoing</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">addAction</span><span class="p">(</span>
<span class="w">            </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">ic_round_stop_24</span><span class="p">,</span>
<span class="w">            </span><span class="n">context</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">string</span><span class="p">.</span><span class="na">alarm_notification_action_cancel</span><span class="p">),</span>
<span class="w">            </span><span class="kc">null</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setContentIntent</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

<span class="w">    </span><span class="nd">@Provides</span>
<span class="w">    </span><span class="nd">@ServiceScoped</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideNotificationManager</span><span class="p">(</span>
<span class="w">        </span><span class="nd">@ApplicationContext</span><span class="w"> </span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">Context</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">NotificationManager</span>

<span class="w">    </span><span class="nd">@Provides</span>
<span class="w">    </span><span class="nd">@ServiceScoped</span>
<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">provideNotificationHelper</span><span class="p">(</span>
<span class="w">        </span><span class="n">notificationBuilder</span><span class="p">:</span><span class="w"> </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Builder</span><span class="p">,</span>
<span class="w">        </span><span class="n">notificationManager</span><span class="p">:</span><span class="w"> </span><span class="n">NotificationManager</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NotificationHelper</span><span class="p">(</span><span class="n">notificationManager</span><span class="p">,</span><span class="w"> </span><span class="n">notificationBuilder</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik az <strong>általad írt kódrészlet</strong>, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>. </p>
<p>A képet a megoldásban a repository-ba f3.png néven töltsd föl.</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="a-service-elkeszitese">A Service elkészítése<a class="headerlink" href="#a-service-elkeszitese" title="Permanent link">&para;</a></h2>
<p>Hozzunk létre egy <code>service</code> package-et, majd ebbe készítsük el az <code>AlarmService</code> osztályt:</p>
<div class="highlight"><pre><span></span><code><span class="k">import</span><span class="w"> </span><span class="nn">android.app.PendingIntent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.app.Service</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.content.Intent</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.media.MediaPlayer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.media.RingtoneManager</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.os.Build</span>
<span class="k">import</span><span class="w"> </span><span class="nn">android.os.IBinder</span>
<span class="k">import</span><span class="w"> </span><span class="nn">androidx.core.app.NotificationCompat</span>
<span class="k">import</span><span class="w"> </span><span class="nn">dagger.hilt.android.AndroidEntryPoint</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.notification.NotificationHelper</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.notification.NotificationHelper.Companion.NOTIFICATION_ID</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.scheduler.AlarmItem</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.scheduler.AlarmScheduler</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.util.AlarmServiceState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">hu.bme.aut.android.alarm.util.AlarmState</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.asStateFlow</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlinx.coroutines.flow.update</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span>
<span class="k">import</span><span class="w"> </span><span class="nn">java.util.Timer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">javax.inject.Inject</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.concurrent.fixedRateTimer</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.time.Duration</span>
<span class="k">import</span><span class="w"> </span><span class="nn">kotlin.time.Duration.Companion.seconds</span>

<span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AlarmService</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Service</span><span class="p">(),</span><span class="w"> </span><span class="n">MediaPlayer</span><span class="p">.</span><span class="na">OnPreparedListener</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">notificationHelper</span><span class="p">:</span><span class="w"> </span><span class="n">NotificationHelper</span>

<span class="w">    </span><span class="nd">@Inject</span>
<span class="w">    </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">alarmScheduler</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmScheduler</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmState</span><span class="p">.</span><span class="na">state</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">lateinit</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">timer</span><span class="p">:</span><span class="w"> </span><span class="n">Timer</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">alarmItem</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmItem? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">var</span><span class="w"> </span><span class="nv">mMediaPlayer</span><span class="p">:</span><span class="w"> </span><span class="n">MediaPlayer? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onStartCommand</span><span class="p">(</span><span class="n">intent</span><span class="p">:</span><span class="w"> </span><span class="n">Intent?,</span><span class="w"> </span><span class="n">flags</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">startId</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">):</span><span class="w"> </span><span class="kt">Int</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">intent</span><span class="o">?.</span><span class="na">action</span><span class="p">.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ACTION_SET</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">intent</span><span class="o">?.</span><span class="na">getStringExtra</span><span class="p">(</span><span class="n">ALARM_TIME</span><span class="p">)</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">durationString</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">Duration</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">durationString</span><span class="p">).</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                            </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                                </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">,</span>
<span class="w">                                </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span>
<span class="w">                            </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                        </span><span class="p">}</span>
<span class="w">                    </span><span class="p">}</span>

<span class="w">                    </span><span class="n">alarmItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmItem</span><span class="p">(</span>
<span class="w">                        </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusSeconds</span><span class="p">(</span>
<span class="w">                            </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="p">.</span><span class="na">inWholeSeconds</span>
<span class="w">                        </span><span class="p">))</span>
<span class="w">                    </span><span class="n">alarmItem</span><span class="o">?.</span><span class="na">let</span><span class="p">(</span><span class="n">alarmScheduler</span><span class="o">::</span><span class="n">schedule</span><span class="p">)</span>

<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">createNotificationChannel</span><span class="p">()</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">setNotificationButton</span><span class="p">(</span>
<span class="w">                        </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                            </span><span class="m">0</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;Pause&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">pauseAlarm</span><span class="p">()</span>
<span class="w">                        </span><span class="p">),</span>
<span class="w">                        </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                            </span><span class="m">0</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">cancelAlarm</span><span class="p">()</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">startForeground</span><span class="p">(</span>
<span class="w">                        </span><span class="n">NOTIFICATION_ID</span><span class="p">,</span>
<span class="w">                        </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">notificationBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">setAlarm</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                        </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">updateNotification</span><span class="p">(</span>
<span class="w">                            </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<span class="w">                            </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmDuration</span><span class="p">.</span><span class="na">inWholeSeconds</span><span class="p">.</span><span class="na">toInt</span><span class="p">()</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">ACTION_PAUSE</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="n">timer</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">timer</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">setNotificationButton</span><span class="p">(</span>
<span class="w">                        </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                            </span><span class="m">0</span><span class="p">,</span>
<span class="w">                            </span><span class="s">&quot;Resume&quot;</span><span class="p">,</span>
<span class="w">                            </span><span class="n">resumeAlarm</span><span class="p">()</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">notificationManager</span><span class="p">.</span><span class="na">notify</span><span class="p">(</span>
<span class="w">                        </span><span class="n">NOTIFICATION_ID</span><span class="p">,</span>
<span class="w">                        </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">notificationBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                    </span><span class="n">alarmItem</span><span class="o">?.</span><span class="na">let</span><span class="p">(</span><span class="n">alarmScheduler</span><span class="o">::</span><span class="n">cancel</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">ACTION_CANCEL</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="n">timer</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">timer</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                    </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">cancelNotification</span><span class="p">()</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">stopForeground</span><span class="p">(</span><span class="n">STOP_FOREGROUND_REMOVE</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">stopForeground</span><span class="p">(</span><span class="n">STOP_FOREGROUND_DETACH</span><span class="p">)</span>
<span class="w">                    </span><span class="n">stopSelf</span><span class="p">()</span>
<span class="w">                    </span><span class="n">alarmItem</span><span class="o">?.</span><span class="na">let</span><span class="p">(</span><span class="n">alarmScheduler</span><span class="o">::</span><span class="n">cancel</span><span class="p">)</span>
<span class="w">                    </span><span class="n">mMediaPlayer</span><span class="o">?.</span><span class="na">stop</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">ACTION_PLAY</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">mMediaPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MediaPlayer</span><span class="p">()</span>
<span class="w">                    </span><span class="n">mMediaPlayer</span><span class="o">?.</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">reset</span><span class="p">()</span>
<span class="w">                        </span><span class="n">setDataSource</span><span class="p">(</span>
<span class="w">                            </span><span class="k">this</span><span class="nd">@AlarmService</span><span class="p">,</span>
<span class="w">                            </span><span class="n">RingtoneManager</span><span class="p">.</span><span class="na">getDefaultUri</span><span class="p">(</span><span class="n">RingtoneManager</span><span class="p">.</span><span class="na">TYPE_ALARM</span><span class="p">)</span>
<span class="w">                        </span><span class="p">)</span>
<span class="w">                        </span><span class="n">setOnPreparedListener</span><span class="p">(</span><span class="k">this</span><span class="nd">@AlarmService</span><span class="p">)</span>
<span class="w">                        </span><span class="n">prepareAsync</span><span class="p">()</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">else</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">when</span><span class="p">(</span><span class="n">intent</span><span class="o">?.</span><span class="na">getStringExtra</span><span class="p">(</span><span class="n">ALARM_STATE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="n">alarmItem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmItem</span><span class="p">(</span>
<span class="w">                    </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">().</span><span class="na">plusSeconds</span><span class="p">(</span>
<span class="w">                        </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="p">.</span><span class="na">inWholeSeconds</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>

<span class="w">                </span><span class="n">alarmItem</span><span class="o">?.</span><span class="na">let</span><span class="p">(</span><span class="n">alarmScheduler</span><span class="o">::</span><span class="n">schedule</span><span class="p">)</span>

<span class="w">                </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">createNotificationChannel</span><span class="p">()</span>
<span class="w">                </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">setNotificationButton</span><span class="p">(</span>
<span class="w">                    </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                        </span><span class="m">0</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;Pause&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">pauseAlarm</span><span class="p">()</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                        </span><span class="m">0</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">cancelAlarm</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">startForeground</span><span class="p">(</span>
<span class="w">                    </span><span class="n">NOTIFICATION_ID</span><span class="p">,</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">notificationBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">setAlarm</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">updateNotification</span><span class="p">(</span>
<span class="w">                        </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">s</span><span class="p">,</span>
<span class="w">                        </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">alarmDuration</span><span class="p">.</span><span class="na">inWholeSeconds</span><span class="p">.</span><span class="na">toInt</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="n">timer</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">timer</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">setNotificationButton</span><span class="p">(</span>
<span class="w">                    </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                        </span><span class="m">0</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;Resume&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">resumeAlarm</span><span class="p">()</span>
<span class="w">                    </span><span class="p">),</span>
<span class="w">                    </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Action</span><span class="p">(</span>
<span class="w">                        </span><span class="m">0</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;Cancel&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="n">cancelAlarm</span><span class="p">()</span>
<span class="w">                    </span><span class="p">)</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">notificationManager</span><span class="p">.</span><span class="na">notify</span><span class="p">(</span>
<span class="w">                    </span><span class="n">NOTIFICATION_ID</span><span class="p">,</span>
<span class="w">                    </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">notificationBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">()</span>
<span class="w">                </span><span class="p">)</span>
<span class="w">                </span><span class="n">alarmItem</span><span class="o">?.</span><span class="na">let</span><span class="p">(</span><span class="n">alarmScheduler</span><span class="o">::</span><span class="n">cancel</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">IDLE</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="n">timer</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">timer</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">notificationHelper</span><span class="p">.</span><span class="na">cancelNotification</span><span class="p">()</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION</span><span class="p">.</span><span class="na">SDK_INT</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">N</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">stopForeground</span><span class="p">(</span><span class="n">STOP_FOREGROUND_REMOVE</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">stopForeground</span><span class="p">(</span><span class="n">STOP_FOREGROUND_DETACH</span><span class="p">)</span>
<span class="w">                </span><span class="n">stopSelf</span><span class="p">()</span>
<span class="w">                </span><span class="n">alarmItem</span><span class="o">?.</span><span class="na">let</span><span class="p">(</span><span class="n">alarmScheduler</span><span class="o">::</span><span class="n">cancel</span><span class="p">)</span>
<span class="w">                </span><span class="n">mMediaPlayer</span><span class="o">?.</span><span class="na">stop</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">super</span><span class="p">.</span><span class="na">onStartCommand</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span><span class="w"> </span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="n">startId</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">setAlarm</span><span class="p">(</span><span class="n">onTick</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">hours</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">minutes</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">:</span><span class="w"> </span><span class="kt">Int</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Unit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fixedRateTimer</span><span class="p">(</span><span class="n">initialDelay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000L</span><span class="p">,</span><span class="w"> </span><span class="n">period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">newDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1.</span><span class="n">seconds</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newDuration</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="p">.</span><span class="na">toComponents</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                    </span><span class="n">onTick</span><span class="p">(</span><span class="n">hours</span><span class="p">.</span><span class="na">toInt</span><span class="p">(),</span><span class="n">minutes</span><span class="p">,</span><span class="n">seconds</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">cancelAlarm</span><span class="p">():</span><span class="w"> </span><span class="n">PendingIntent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">cancelIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putExtra</span><span class="p">(</span><span class="n">ALARM_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span><span class="p">.</span><span class="na">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">getService</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">CANCEL_REQUEST_CODE</span><span class="p">,</span><span class="w"> </span><span class="n">cancelIntent</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">resumeAlarm</span><span class="p">():</span><span class="w"> </span><span class="n">PendingIntent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">resumeIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putExtra</span><span class="p">(</span><span class="n">ALARM_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">.</span><span class="na">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">getService</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">RESUME_REQUEST_CODE</span><span class="p">,</span><span class="w"> </span><span class="n">resumeIntent</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">pauseAlarm</span><span class="p">():</span><span class="w"> </span><span class="n">PendingIntent</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">pauseIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">applicationContext</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">putExtra</span><span class="p">(</span><span class="n">ALARM_STATE</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span><span class="p">.</span><span class="na">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">getService</span><span class="p">(</span>
<span class="w">            </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">PAUSE_REQUEST_CODE</span><span class="p">,</span><span class="w"> </span><span class="n">pauseIntent</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onDestroy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">super</span><span class="p">.</span><span class="na">onDestroy</span><span class="p">()</span>
<span class="w">        </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">            </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">            </span><span class="n">alarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">            </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span><span class="p">,</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">::</span><span class="n">timer</span><span class="p">.</span><span class="na">isInitialized</span><span class="p">)</span><span class="w"> </span><span class="n">timer</span><span class="p">.</span><span class="na">cancel</span><span class="p">()</span>
<span class="w">        </span><span class="n">mMediaPlayer</span><span class="o">?.</span><span class="na">release</span><span class="p">()</span>
<span class="w">        </span><span class="n">mMediaPlayer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onBind</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span><span class="w"> </span><span class="n">Intent?)</span><span class="p">:</span><span class="w"> </span><span class="n">IBinder? </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span>

<span class="w">    </span><span class="kd">companion</span><span class="w"> </span><span class="kd">object</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ALARM_STATE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_STATE&quot;</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ACTION_SET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_SET&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ACTION_PAUSE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_PAUSE&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ACTION_CANCEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_CANCEL&quot;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ACTION_PLAY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_PLAY&quot;</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">ALARM_TIME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;ALARM_TIME&quot;</span>

<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">FLAG_IMMUTABLE</span>

<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">CANCEL_REQUEST_CODE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">102</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">RESUME_REQUEST_CODE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">103</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">PAUSE_REQUEST_CODE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">104</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onPrepared</span><span class="p">(</span><span class="n">mediaPlayer</span><span class="p">:</span><span class="w"> </span><span class="n">MediaPlayer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mediaPlayer</span><span class="p">.</span><span class="na">start</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Tekintsük át, hogyan is működik a fenti <code>Service</code>! Egy Android <code>Service</code> két módon működhet. Lehet "Started Service", ez azt jelenti, hogy indulás után a háttérben (Background Service) teszi a dolgát, amíg az alkalmazás valamilyen komponense látható, vagy akár akkor is működik, amikor az alkalmazás nem látható (Foreground Service), viszont ilyenkor egy értesítést kötelező megjelenítenie, hogy a felhasználó számára ne maradhasson észrevétlen (biztonsági okokból). Az <code>AlarmService</code> az alkalmazásunkban egy Foreground Service-ként működik, hogy az időzítő akkor se álljon le, ha az alkalmazás felülete már nincs előtérben. A <code>Service</code> másik lehetséges működési módja a "Bound Service". Ez azt jelenti, hogy más komponensek kapcsolódhatnak hozzá, és feladatokat végeztethetnek vele. Addig működik ilyen módon, amíg legalább egy kapcsolódó komponens van. Egy <code>Service</code> lehetne egyszerre "Started Service" és "Bound Service" is, de most utóbbi funkcionalitásra nincs szükség az alkalmazásban, mert "Started Service"-ként képes az állapotot frissíteni, aminek változása utána a felhasználói felületen is megjelenik.</p>
<p>Nézzük át előbb az <code>AlarmService</code> segédmetódusait:</p>
<ul>
<li><code>setAlarm</code>: ez elindítja az időzítést, és ehhez beállít egy másodpercenkénti ütemezőt is, amellyel majd lehet frissíteni a felhasználói felületen, illetve a megjelenített értesítésben kijelzett hátralevő időt. Ez a metódus callbackként kapja meg, hogy mit kell futtatnia, amikor egy másodperc eltelt.</li>
<li><code>cancelAlarm</code>: ez egy <code>PendingIntent</code>et gyárt le, amellyel megállítható az időzítő. A <code>PendingIntent</code> magának az <code>AlarmService</code>-nek küldi a megfelelő <code>Intent</code>et, és ez a <code>PendingIntent</code> majd az értesítésben megjelenített akcióhoz rendelhető.</li>
<li><code>resumeAlarm</code>: az előzőhöz hasonló, de az időzítés újraindításához használandó.</li>
<li><code>pauseAlarm</code>: mint az előzőek, de pauzálásra.</li>
</ul>
<p>Az <code>AlarmService</code> lényegi logikája az <code>onStartCommand</code> metódusban van megvalósítva. Ez az eseménykezelő akkor fut le, amikor a <code>Service</code>-t "Started Service"-ként indítják. Ez egy <code>Intent</code> küldésével történik, amelyben az action és az extras segítségével utaznak a paraméterek, hogy a <code>Service</code>-től mit is kérünk. Nézzük végig az egyes eseteket! Alapvetően mindig az állapot megfelelő beállítása, az időzítő logika meghívása, illetve az értesítés megjelenítése/frissítése történik a korábban áttekintett kódrészletek meghívásával. Különösen fontos részlet, hogy az <code>ACTION_SET</code> akció, azaz az időzítő elindítása esetén a <code>Service</code> a <code>startForeground</code> hívással foreground módba kerül, hogy akkor is működjön továbbra is az időzítés, ha az alkalmazás nem látható. Megfigyelendő még az <code>ACTION_PLAY</code> esetében a <code>MediaPlayer</code> API használata az ébresztő dallam lejátszásához.</p>
<p>Mivel a <code>Service</code> is egy fő komponenstípus Androidon, ezért ezt a Manifest fájlban is szükséges regisztrálni:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;service</span>
<span class="w">    </span><span class="na">android:name=</span><span class="s">&quot;.service.AlarmService&quot;</span>
<span class="w">    </span><span class="na">android:enabled=</span><span class="s">&quot;true&quot;</span>
<span class="w">    </span><span class="na">android:exported=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</code></pre></div>
<p>Most már összeköthetők a <code>ViewModel</code> és a <code>Service</code> is az <code>AlarmViewModel</code> megfelelő kiegészítésével:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@HiltViewModel</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">AlarmViewModel</span><span class="w"> </span><span class="nd">@Inject</span><span class="w"> </span><span class="k">constructor</span><span class="p">():</span><span class="w"> </span><span class="n">ViewModel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmState</span><span class="p">.</span><span class="na">state</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_state</span><span class="p">.</span><span class="na">asStateFlow</span><span class="p">()</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">onEvent</span><span class="p">(</span><span class="n">event</span><span class="p">:</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">when</span><span class="p">(</span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">SetAlarmDuration</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">duration</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">duration</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">SetAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmService</span><span class="p">.</span><span class="na">ACTION_SET</span>
<span class="w">                    </span><span class="n">state</span><span class="p">.</span><span class="na">value</span><span class="p">.</span><span class="na">currentAlarmDuration</span><span class="p">.</span><span class="na">toString</span><span class="p">()</span>
<span class="w">                    </span><span class="n">context</span><span class="p">.</span><span class="na">startService</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">PauseAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">PAUSE</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmService</span><span class="p">.</span><span class="na">ACTION_PAUSE</span>
<span class="w">                    </span><span class="n">context</span><span class="p">.</span><span class="na">startService</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">ResumeAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">SET</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmService</span><span class="p">.</span><span class="na">ACTION_SET</span>
<span class="w">                    </span><span class="n">context</span><span class="p">.</span><span class="na">startService</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">is</span><span class="w"> </span><span class="n">AlarmEvent</span><span class="p">.</span><span class="na">StopAlarm</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kd">val</span><span class="w"> </span><span class="nv">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">context</span>

<span class="w">                </span><span class="n">_state</span><span class="p">.</span><span class="na">update</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">it</span><span class="p">.</span><span class="na">copy</span><span class="p">(</span>
<span class="w">                    </span><span class="n">currentAlarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmDuration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Duration</span><span class="p">.</span><span class="na">ZERO</span><span class="p">,</span>
<span class="w">                    </span><span class="n">alarmState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmServiceState</span><span class="p">.</span><span class="na">CANCELED</span><span class="p">,</span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="p">}</span>

<span class="w">                </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">AlarmService</span><span class="o">::</span><span class="n">class</span><span class="p">.</span><span class="na">java</span><span class="p">).</span><span class="na">apply</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="na">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AlarmService</span><span class="p">.</span><span class="na">ACTION_CANCEL</span>
<span class="w">                    </span><span class="n">context</span><span class="p">.</span><span class="na">startService</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik a <strong>futó alkalmazás</strong>, az <strong>általad írt kódrészlet</strong>, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>. </p>
<p>A képet a megoldásban a repository-ba f4.png néven töltsd föl.</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>
<h2 id="onallo-feladat">Önálló feladat<a class="headerlink" href="#onallo-feladat" title="Permanent link">&para;</a></h2>
<p>Valósítsd meg az ébresztőórákon megszokott "szundi" funkciót! Amikor az időzítő letelik, jeleníts meg az értesítésen egy "Snooze" gombot is, amivel e riasztás abbamarad, és egy újabb 5 perces időzítés indul.</p>
<div class="admonition example">
<p class="admonition-title">BEADANDÓ (1 pont)</p>
<p>Készíts egy <strong>képernyőképet</strong>, amelyen látszik a <strong>futó alkalmazás</strong>, az <strong>általad írt kódrészlet</strong>, valamint a <strong>neptun kódod a kódban valahol kommentként</strong>. </p>
<p>A képet a megoldásban a repository-ba f5.png néven töltsd föl.</p>
<p>A képernyőkép szükséges feltétele a pontszám megszerzésének.</p>
</div>

    <hr>
  <div class="md-source-file">
    <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
          xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
          </path>
        </svg>
      </span>
      <span title="2024. január 19. 09:44:44">
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-01-19T09:44:44+01:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-01-19</span>
      </span>
    </span>

    

    <span class="md-source-file__fact">
      <span class="md-icon" title="Szerzők">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
          </path>
        </svg>
      </span>
      <span>Szerzők</span>
      <nav></nav>      
    </span>
  </div>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Vissza a tetejére
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>